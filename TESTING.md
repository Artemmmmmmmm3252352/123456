# Инструкция по тестированию Appwrite интеграции

## Проверка подключения

1. **Запустите приложение:**
   ```bash
   npm run dev
   ```

2. **Проверьте консоль браузера** на наличие ошибок подключения к Appwrite

## Тестирование функций

### 1. Регистрация и вход пользователя

1. Перейдите на страницу регистрации
2. Создайте нового пользователя
3. Проверьте в Appwrite Console, что пользователь создан в коллекции `users`
4. Войдите с созданными учетными данными
5. Проверьте, что сессия сохраняется

### 2. Работа с чатом

1. Войдите в систему
2. Перейдите в раздел "Chat"
3. Создайте новое сообщение
4. Проверьте в Appwrite Console, что:
   - Создана сессия в коллекции `chat_sessions`
   - Сообщения сохраняются в поле `messages` (как JSON строка)
5. Создайте несколько сессий
6. Проверьте, что все сессии отображаются в боковой панели

### 3. Работа с продуктами

1. Перейдите в раздел "Store" (Marketplace)
2. Проверьте, что продукты загружаются из Appwrite
3. Если продуктов нет, они должны автоматически инициализироваться из `PRODUCTS`
4. Перейдите в админ-панель (`/admin`)
5. Добавьте новый продукт
6. Проверьте в Appwrite Console, что продукт создан в коллекции `products`
7. Вернитесь в Store и убедитесь, что новый продукт отображается

### 4. Покупка продуктов

1. Пополните баланс через раздел "Subscription"
2. Купите продукт в Store
3. Проверьте в Appwrite Console:
   - Баланс пользователя уменьшился
   - Продукт добавлен в `inventory`
   - Транзакция добавлена в `transactions`

### 5. Проверка JSON полей

В Appwrite Console проверьте, что сложные поля хранятся как JSON строки:
- `quota` - объект `{"used": 0, "lastReset": timestamp}`
- `inventory` - массив `["product_id1", "product_id2"]`
- `subscription` - объект `{"plan": "free", "expiresAt": null}`
- `stats` - объект `{"tokensUsed": 0, "chatsCount": 0, "totalSpent": 0}`
- `transactions` - массив объектов
- `messages` (в chat_sessions) - массив сообщений

## Возможные проблемы и решения

### Ошибка "Collection not found"
- Убедитесь, что коллекции созданы с правильными ID: `users`, `chat_sessions`, `products`
- Проверьте, что база данных имеет ID: `main`

### Ошибка "Permission denied"
- Проверьте права доступа в Appwrite Console
- Для коллекции `users`: Create/Read/Update/Delete - Any
- Для коллекции `chat_sessions`: Create/Read/Update/Delete - Users (только свои)
- Для коллекции `products`: Create/Read/Update/Delete - Any

### Данные не сохраняются
- Проверьте консоль браузера на наличие ошибок
- Убедитесь, что API ключ правильный в `src/lib/appwrite.ts`
- Проверьте, что все атрибуты созданы правильно в коллекциях

### JSON поля не работают
- Убедитесь, что в Appwrite атрибуты имеют тип String
- Проверьте, что размер атрибутов достаточен (например, 10000 для quota, 100000 для messages)

## Проверка в Appwrite Console

1. Откройте [Appwrite Console](https://cloud.appwrite.io)
2. Перейдите в ваш проект
3. Откройте раздел **Databases** → **main**
4. Проверьте коллекции:
   - `users` - должны быть зарегистрированные пользователи
   - `chat_sessions` - должны быть сессии чата
   - `products` - должны быть продукты

5. Откройте любой документ и проверьте структуру данных

## Успешная интеграция

Если все работает правильно:
- ✅ Пользователи регистрируются и сохраняются в Appwrite
- ✅ Сессии чата создаются и обновляются
- ✅ Продукты загружаются и отображаются
- ✅ Покупки сохраняются в базе данных
- ✅ Все JSON поля правильно сериализуются/десериализуются
